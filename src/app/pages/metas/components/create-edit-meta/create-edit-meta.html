<!-- Overlay -->
<div class="fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-center justify-center p-4">
  <!-- Modal -->
  <div class="bg-white/95 backdrop-blur-xl rounded-3xl p-6 shadow-2xl max-w-md w-full border border-white/20" (click)="$event.stopPropagation()">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-2xl font-bold bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent flex items-center gap-2">
        <div class="p-2 bg-gradient-to-br from-pink-500 to-purple-600 rounded-2xl">
          <lucide-icon name="target" class="text-white" [size]="28"></lucide-icon>
        </div>
        {{ isEditMode ? 'Editar Meta' : 'Nueva Meta' }}
      </h3>
      <button (click)="closeModal()" class="text-3xl text-gray-400 hover:text-gray-600 transition-colors">&times;</button>
    </div>

    <form [formGroup]="metaForm" (ngSubmit)="onSubmit()" class="space-y-4">
      <div>
        <label class="block text-sm font-bold mb-2 text-gray-700">Título *</label>
        <input
          type="text"
          formControlName="titulo"
          placeholder="Ej: Viajar a París"
          [class.ring-2]="submitted && f['titulo'].errors"
          [class.ring-red-400]="submitted && f['titulo'].errors"
          class="w-full px-4 py-3 rounded-2xl bg-gray-50 border border-gray-200 text-gray-800 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-transparent"
        />
        @if (submitted && f['titulo'].errors) {
          <div class="mt-2">
            @if (f['titulo'].errors['required']) {
              <p class="text-red-600 text-sm">El título es requerido</p>
            }
            @if (f['titulo'].errors['maxlength']) {
              <p class="text-red-600 text-sm">Máximo 200 caracteres</p>
            }
          </div>
        }
      </div>

      <div>
        <label class="block text-sm font-bold mb-2 text-gray-700">Descripción</label>
        <textarea
          formControlName="descripcion"
          rows="4"
          placeholder="Describe tu meta..."
          class="w-full px-4 py-3 rounded-2xl bg-gray-50 border border-gray-200 text-gray-800 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-transparent resize-none"
        ></textarea>
      </div>

      @if (isEditMode) {
        <div>
          <label class="block text-sm font-bold mb-2 text-gray-700">Progreso (%) *</label>
          <select
            formControlName="progreso"
            [class.ring-2]="submitted && f['progreso'].errors"
            [class.ring-red-400]="submitted && f['progreso'].errors"
            class="w-full px-4 py-3 rounded-2xl bg-gray-50 border border-gray-200 text-gray-800 focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-transparent"
          >
            @for (porcentaje of porcentajes; track porcentaje) {
              <option [value]="porcentaje">{{ porcentaje }}%</option>
            }
          </select>
          @if (submitted && f['progreso'].errors) {
            <div class="mt-2">
              @if (f['progreso'].errors['required']) {
                <p class="text-red-600 text-sm">El progreso es requerido</p>
              }
            </div>
          }
        </div>

        <div>
          <label class="block text-sm font-bold mb-2 text-gray-700">Estado *</label>
          <select
            formControlName="estado"
            [class.ring-2]="submitted && f['estado'].errors"
            [class.ring-red-400]="submitted && f['estado'].errors"
            class="w-full px-4 py-3 rounded-2xl bg-gray-50 border border-gray-200 text-gray-800 focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-transparent"
          >
            @for (estado of estadoOptions; track estado.valor) {
              <option [value]="estado.valor">{{ estado.nombre }}</option>
            }
          </select>
          @if (submitted && f['estado'].errors) {
            <div class="mt-2">
              <p class="text-red-600 text-sm">El estado es requerido</p>
            </div>
          }
        </div>
      }

      <div class="flex gap-3 pt-4">
        <button
          type="button"
          (click)="closeModal()"
          class="flex-1 py-3 bg-gray-100 text-gray-700 font-bold rounded-2xl hover:bg-gray-200 transition-all">
          Cancelar
        </button>
        <button
          type="submit"
          [disabled]="metaForm.invalid || submitted"
          class="flex-1 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold rounded-2xl hover:from-pink-600 hover:to-purple-700 transition-all shadow-lg shadow-pink-500/30 disabled:opacity-50 disabled:cursor-not-allowed">
          {{ submitted ? 'Guardando...' : (isEditMode ? 'Actualizar' : 'Crear') }}
      </button>
    </div>
  </form>
</div>
